# ==============================
# WebServ Configuration Example
# ==============================

server {

    # Port where the server listens for incoming connections
    # IP address to bind the server to (127.0.0.1 = localhost only)
    listen 127.0.0.1:8080;

    # Domain name that this server responds to
    server_name localhost;

    # Root directory where website files are stored
    # All requests without a specific root in a location block will be served from here.
    root ./www;

    # Default file served when accessing a directory
    index index.html;

    # Maximum allowed size of client request body (file uploads, POST data)
    client_max_body_size 10m;

    # Custom error page mapping
    error_page 400 /error/400.html;
    error_page 403 /error/403.html;
    error_page 404 /error/404.html;
    error_page 405 /error/405.html;
    error_page 413 /error/413.html;
    error_page 500 /error/500.html;
    error_page 502 /error/502.html;
    error_page 508 /error/508.html;

    # ==================================
    # Default Location ("/")
    # ==================================
    location / {

        # Override root directory for this location (optional)
        root ./www;

        # Default file inside this location
        index index.html;

        # Allowed HTTP methods for this location
        allowed_methods GET HEAD POST PUT DELETE;

        # Enable directory listing if no index file exists
        autoindex on;

        # Maximum request body size specific to this location
        client_max_body_size 5m;
    }


    # ==================================
    # Upload Directory
    # ==================================
    location /uploads {

        # Allow uploading and retrieving files
        allowed_methods GET POST PUT DELETE;

        # Enable directory listing of uploaded files
        autoindex on;

        # Directory where uploaded files are stored
        upload_store ./www/uploads;

        # Limit upload size for this location
        client_max_body_size 20m;
    }


    # ==================================
    # CGI Scripts
    # Location for executing server-side scripts
    # Scripts in this directory (e.g., .py, .sh) are run by their assigned interpreters
    # and can generate dynamic content for the client
    # ==================================

    location /cgi-bin {

        # Only allow GET and POST for CGI execution
        allowed_methods GET POST;

        # Assign interpreter for specific file extensions
        # Format: cgi_assign <extension> <interpreter_path>
        cgi_assign .py /usr/bin/python3;
        cgi_assign .sh /usr/bin/bash;

        # Optional redirect example
        # return <status_code> <url_or_path>
        # Example:
        # return 301 http://localhost:8080/;
    }
}
